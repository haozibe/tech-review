### 应用内部

1. RateLimit产生令牌，限流。
2. springmvc合理的调整线程池配置
3. 避免远程调用和大量IO的堵塞操作，如果无法避免，考虑做成异步处理。
4. 对部分业务考虑采用预处理，或预计算，减少实时计算量。

### redis

1. 更新数据时，使用redis watch命令，如果更新时，数据被修改，则更新失败。乐观锁机制。
2. 缓存用户第一页的订单信息，一页12条。用户访问订单列表，如果是第一页读缓存，如果不是读DB。更新数据时，先更新数据库，再更新缓存，循环三次更新缓存失败，将发一个缓存更新失败的mq，通过消费mq更新缓存。
3. 避免缓存穿透，判断缓存是否存在，获取锁，初始化128个锁，通过uuid和127取摸获取锁的index，保证一个用户只能有一条线程操作数据库，减轻数据库的压力，上锁后再判断一次缓存是否存在，如果不存在，才去数据库查询，如果数据库查出没有数据，则在缓存中放入Null，标识这个客户真的没有数据，等有订单入库时，会删掉该标识，并放入订单数据。
4. hash适合存放对象，hash中的key为设置的key，但是value为一个map，map的key为对应成员的属性。
5. 分布式锁缺点，客户端A处理超时，客户端B获取锁，仍认为自己拥有锁，导致A处理完后释放锁，B仍在处理。主从复制时，master宕机，节点被推选成Master导致B客户端可以从节点获取到锁。

### 锁续命问题



### redis限流算法

- 限制瞬时并发数
- 限制时间窗最大请求数
- 限流令牌桶



### 数据库

1. 利用存储过程提高处理能力。
2. 合理的使用数据库引擎，在数量较少，不含事务的表中，MyISAM的性能要优于Innodb。
3. 数据库集群，进行读写分离。
4. 合理设计数据库的表结构和索引。
5. 分库分表，降低单库单表的数据量。